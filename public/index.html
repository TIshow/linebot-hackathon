<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>夢日記アプリ</title>

<!-- font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  async function initializeLiff() {
    try {
      await liff.init({ liffId: "2004698497-4e8mJBR3" });
      if (!liff.isLoggedIn()) {
        liff.login();
      } else {
        const profile = await liff.getProfile();
        // document.getElementById('line-name').textContent = profile.displayName + 'さんの夢';

        // Fetch dreams data
        const userId = profile.userId;
        const url = `/fetchDreams?userId=${userId}`;
        fetch(url)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
          })
          .then(dreams => {
            if (dreams.length > 0) {
              const timeContainer = document.querySelector('.diaryContainer__time');
              const textContainer = document.querySelector('.diaryContainer__text');
              // Display the first dream in the provided containers
              timeContainer.textContent = dreams[0].Timestamp;
              textContainer.textContent = dreams[0].Story;
            }
          })
        .catch(error => {
          console.error('Fetch error:', error);
        });
      }
    } catch (error) {
      console.error('LIFF initialization failed:', error);
    }
  }

  document.addEventListener("DOMContentLoaded", initializeLiff);
</script>
<style>
  * {
    font-family: "DotGothic16", sans-serif;
    color: white;
  }
  
  .container {
    min-height: 100vh;
    background-image: linear-gradient(180deg, rgba(48, 174, 205, 1), rgba(43, 99, 103, 1) 60%, rgba(1, 8, 8, 1));
  }
  
  .header {
    height: 60px;
  }
  
  .diaryContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 20px;
    padding: 14px 14px ;
    border: 3px solid white;
  }
  
  .diaryContainer__time {
    font-size: 20px;
    margin-bottom: 10px;
  }
  
  .diaryContainer__image {
    max-width: 400px;
    height: 300px;
    object-fit: cover;
    border: 3px solid white;
  }
  
  .analysis {
    padding: 14px;
  }
  
  h2 {
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      ゆめにっき
    </div>
    <div class="diaryContainer">
      <div class="diaryContainer__time"></div>
      <div class="diaryContainer__image"></div>
      <div class="diaryContainer__text"></div>
    </div>
    <div class="analysis">
      <h2>Dr.ゆめうさぎの夢分析</h2>
      <p class="analysis__text"></p>
    </div>
    <div class="footer">copyright</div>
  </div>
</body>
</html>

