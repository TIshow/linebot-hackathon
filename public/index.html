<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>夢日記アプリ</title>
<link rel="stylesheet" href="styles.css">
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
  async function initializeLiff() {
    try {
      await liff.init({ liffId: "2004698497-4e8mJBR3" });
      if (!liff.isLoggedIn()) {
        liff.login();
      } else {
        const profile = await liff.getProfile();
        document.getElementById('line-name').textContent = profile.displayName + 'さんの夢';

        // Fetch dreams data
        const userId = profile.userId;
        const url = `/fetchDreams?userId=${userId}`;
        fetch(url)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
          })
          .then(dreams => {
            const container = document.getElementById('dreamsContainer');
            dreams.forEach(dream => {
              const div = document.createElement('div');
              div.textContent = `${dream.Timestamp}: ${dream.Story}`;
              container.appendChild(div);
            });
          })
        .catch(error => {
          console.error('Fetch error:', error);
        });
      }
    } catch (error) {
      console.error('LIFF initialization failed:', error);
    }
  }

  document.addEventListener("DOMContentLoaded", initializeLiff);
</script>
</head>
<body>
  <div class="container">
    <h1>過去の夢日記</h1>
    <p>
      <span id="line-name"></span>
    </p>
    <div id="dreamsContainer"></div>
  </div>
</body>
</html>
